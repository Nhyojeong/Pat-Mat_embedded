<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT 문제 풀이</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        h1 {
            margin-bottom: 1em;
        }
        p {
            font-size: 1.2em;
            margin-bottom: 1em;
        }
        button {
            padding: 0.5em 1em;
            font-size: 1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 0.5em;
        }
        button:hover {
            background-color: #45a049;
        }
        input {
            font-size: 1.2em;
            padding: 0.5em;
            margin: 0.5em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #logo {
            position: absolute;
            top: 10px;
            left: 10px;
        }
        #logo a {
            text-decoration: none;
            color: black;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <h1>GPT 문제 풀이</h1>
    <div id="logo">
        <a href="index.html">Home</a>
    </div>

    <p id="gpt-question">GPT가 문제를 생성 중입니다...</p>
    <input type="text" id="user-answer" placeholder="정답을 입력하세요">
    <button id="submit-answer">제출</button>

    <div id="result"></div>

    <script src="app.js"></script>
    <script>
        // GPT에서 받은 문제를 저장할 변수
        let gptQuestion = '';

        // 이전 페이지에서 저장된 문제 가져오기
        const lastKey = localStorage.key(localStorage.length - 1);
        const lastRecord = JSON.parse(localStorage.getItem(lastKey));
        const savedText = lastRecord ? lastRecord.question : '';

        // GPT에게 저장된 문제에 대한 새로운 문제 요청
        async function generateGPTQuestion() {
            const aiPrompt = `최근 입력한 영어 본문을 기반으로 한국 수능 수준의 영어 문제 하나만 내줘. 본문은 다시 언급하지 않아도 돼. 정답을 숫자 1~4 중에 하나를 선택할 수 있게 내줘 제발: "${savedText}"`;
            const relatedQuestion = await fetchAIResponse(aiPrompt);
            gptQuestion = relatedQuestion;

            // 문제 표시
            document.getElementById('gpt-question').textContent = relatedQuestion
                ? `문제: ${relatedQuestion}`
                : '문제가 포함되지 않았습니다.';
        }

        // 페이지 로드 시 GPT로부터 문제 생성
        window.onload = generateGPTQuestion;

        // 정답 제출 시 처리
        document.getElementById('submit-answer').addEventListener('click', async () => {
            const userAnswer = document.getElementById('user-answer').value.trim();

            if (!userAnswer) {
                alert('정답을 입력하세요.');
                return;
            }

            // GPT에게 사용자의 정답 확인 요청
            const checkPrompt = `문제: ${gptQuestion} 사용자의 답: ${userAnswer}. 문제의 정답에 대해서 사용자가 입력한 답이 맞는지 확인해줘. 사용자의 답이 문제에 대한 답 안에 들어가면 '정답입니다'라고 말해줘 아니면 '틀림'으로 말해줘.`;
            const checkResponse = await fetchAIResponse(checkPrompt);

            // GPT 응답에 "정답입니다"가 포함되어 있는지 확인
            if (checkResponse.includes('정답입니다')) {
                alert('정답입니다!');
                document.getElementById('result').textContent = '정답입니다!';
                document.getElementById('user-answer').value = ''; // 입력 필드 초기화
                window.location.href = 'record.html';  // 기록 페이지로 이동
            } else {
                alert('틀렸습니다.');
                const tryAgain = confirm('다시 풀어보시겠습니까?');
                if (!tryAgain) {
                    const save = confirm('이 문제를 저장하시겠습니까?');
                    if (save) {
                        const timestamp = new Date().getTime();
                        const record = { question: gptQuestion, answer: userAnswer };
                        localStorage.setItem(timestamp, JSON.stringify(record));
                        alert('문제가 저장되었습니다.');
                    }
                    window.location.href = 'record.html';  // 기록 페이지로 이동
                } else {
                    document.getElementById('user-answer').value = ''; // 다시 풀게 할 때 입력 필드 초기화
                }
            }
        });

    </script>
</body>
</html>
